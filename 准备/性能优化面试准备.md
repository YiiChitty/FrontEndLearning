# 性能优化相关问题

## 1.为什么要强调CSS要放在header里，js放在尾部？

> ### DOMContentLoaded 和 load
>
> - DOMContentLoaded 事件触发时，仅当DOM加载完成，不包括样式表，图片...
> - load 事件触发时，页面上所有的DOM，样式表，脚本，图片都已加载完成

构建Render树需要DOM和CSSOM，所以**HTML和CSS都会阻塞渲染**。所以需要让CSS**尽早加载**（如：放在头部），以**缩短首次渲染的时间**。

阻塞浏览器的解析，也就是说发现一个外链脚本时，**需等待脚本下载完成并执行后才会继续解析HTML**。

普通的脚本会阻塞浏览器解析，**加上defer或async属性，脚本就变成异步，可等到解析完毕再执行**

- async异步执行，异步下载完毕后就会执行，不确保执行顺序，一定在onload前，但不确定在DOMContentLoaded事件的前后
- defer延迟执行，相当于放在body最后（理论上在DOMContentLoaded事件前）

## 2.白屏、首屏

### 白屏

白屏时间指的是浏览器开始显示内容的时间，一般认为浏览器开始渲染body或者解析完head标签的时候就是页面白屏结束的时间。

计算方法：IE8-： title后输出一个时间pagestartime;

head结束前 输出一个时间firstpaint。

白屏时间=firstpaint-pagestarttime/performance.timing.navigationStart;

**优化**

1.加快js的执行速度，比如无限滚动的页面，可以用js先渲染一个屏幕范围内的东西

2.减少文件体积

3.首屏同步渲染html,后续的滚屏再异步加载和渲染。

### 首屏

首屏时间是指用户打开网站开始，到浏览器首屏内容渲染完成的时间。

计算方法：

1.模块标签标记。适用于内容不需要拉取数据才能生存以及页面不考虑图片等资源的加载情况。结束位置加时间戳输出时间。

2.统计首屏内图片加载最慢事件。 通常图片加载最慢，所以会把首屏内加载事件最慢的图片时间。

3.自定义计算

**优化**

首屏数据拉取逻辑放在顶部（数据最快返回）

首屏渲染css及js逻辑优先内联html，返回时能立即执行

次屏逻辑延后执行

### DOM构建时间

浏览器开始对基础页文件内容进行解析，构建出一个DOM树的时间。domready事件在DOM加载后、资源加载之前被触发，在本地浏览器的DOMContentLoaded事件的形式被调用。

### 整页时间

整个页面加载完成时间

loadEvntEnd-navigationStart/onload记录时间戳。



